# multicdn_preference_config (Resource)

Manages a CDN preference configuration that controls how CDNs are selected based on availability thresholds, performance metrics, and region-specific settings.

## Example Usage

### Basic Configuration

```terraform
resource "multicdn_preference_config" "basic_preferences" {
  resource_id  = multicdn_cdn_config.website.resource_id  # Link to your CDN config
  description  = "Basic CDN preference settings"
  content_type = "website"
  
  # Define minimum availability thresholds (percentage)
  availability_thresholds = {
    world = 95  # Global default availability threshold (95%)
  }
  
  # Define performance filtering options
  performance_filtering = {
    world = {
      mode = "relative"  # Use relative performance filtering
    }
  }
  
  # Define countries where subdivision-level granularity is enabled
  enabled_subdivision_countries = {
    continents = {
      "NA" = {
        countries = ["US", "CA"]  # Enable subdivisions for US and Canada
      }
    }
  }
}
```

### Advanced Configuration with Region-Specific Settings

```terraform
resource "multicdn_preference_config" "advanced_preferences" {
  resource_id  = multicdn_cdn_config.video_streaming.resource_id
  description  = "Advanced CDN preference settings for video streaming"
  content_type = "video"
  
  # Define region-specific availability thresholds
  availability_thresholds = {
    world = 90  # Global default availability threshold (90%)
    
    continents = {
      "NA" = {
        default = 95  # Higher threshold for North America (95%)
        countries = {
          "US" = 98,  # Even higher for US (98%)
          "CA" = 96   # Higher for Canada (96%)
        }
      },
      "EU" = {
        default = 94  # Higher threshold for Europe (94%)
        countries = {
          "DE" = 96,  # Higher for Germany (96%)
          "FR" = 95   # Higher for France (95%)
        }
      },
      "AS" = {
        default = 85  # Lower threshold for Asia (85%)
      }
    }
  }
  
  # Define region-specific performance filtering rules
  performance_filtering = {
    world = {
      mode = "relative"  # Use relative performance filtering globally
    },
    
    continents = {
      "NA" = {
        mode = "relative",
        relative_threshold = 0.2,
        countries = {
          "US" = {
            mode = "relative",
            relative_threshold = 0.1
          }
        }
      },
      "EU" = {
        mode = "relative",
        relative_threshold = 0.3
      },
      "AS" = {
        mode = "relative",
        relative_threshold = 0.5
      }
    }
  }
  
  # Define countries where subdivision-level granularity is enabled
  enabled_subdivision_countries = {
    continents = {
      "NA" = {
        countries = ["US", "CA", "MX"]
      },
      "EU" = {
        countries = ["DE", "FR", "UK", "IT", "ES"]
      },
      "AS" = {
        countries = ["JP", "CN", "IN", "SG"]
      }
    }
  }
}
```

### Configuration Linked with CDN Config

```terraform
# First define your CDN configuration
resource "multicdn_cdn_config" "api_gateway" {
  resource_id  = 12345
  content_type = "api"
  description  = "API Gateway CDN configuration"

  cdns = [
    {
      cdn_name     = "CloudFront"
      description  = "AWS CloudFront CDN"
      fqdn         = "d1234abcdef.cloudfront.net"
      client_cdn_id = "CF12345"
    },
    {
      cdn_name     = "Fastly"
      description  = "Fastly CDN"
      fqdn         = "example.global.fastly.net"
      client_cdn_id = "FY67890"
    }
  ]

  cdn_enablement_map = {
    world_default = ["CF12345", "FY67890"]
  }

  traffic_distribution = {
    world_default = {
      options = [
        {
          name = "standard-distribution"
          distribution = [
            { id = "CF12345", weight = 50 },
            { id = "FY67890", weight = 50 }
          ]
        }
      ]
    }
  }
}

# Then define preferences that reference the CDN config
resource "multicdn_preference_config" "api_preferences" {
  resource_id  = multicdn_cdn_config.api_gateway.resource_id
  content_type = "api"
  description  = "API Gateway preferences"
  
  availability_thresholds = {
    world = 99  # High availability requirement for API
    
    continents = {
      "NA" = {
        default = 99.5  # Even higher for North America
      },
      "EU" = {
        default = 99.5  # Even higher for Europe
      }
    }
  }
  
  performance_filtering = {
    world = {
      mode = "relative"
    },
    continents = {
      "NA" = {
        mode = "relative",
        relative_threshold = 0.9
      },
      "EU" = {
        mode = "relative",
        relative_threshold = 0.1
      }
    }
  }
  
  enabled_subdivision_countries = {
    continents = {
      "NA" = {
        countries = ["US"]  # Enable state-level granularity in US
      }
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `resource_id` (Number) Unique ID of the CDN preference configuration
- `availability_thresholds` (Attributes) Availability thresholds configuration (see [below for nested schema](#nestedatt--availability_thresholds))
- `performance_filtering` (Attributes) Performance filtering configuration (see [below for nested schema](#nestedatt--performance_filtering))
- `enabled_subdivision_countries` (Attributes) Configuration for countries with enabled subdivisions (see [below for nested schema](#nestedatt--enabled_subdivision_countries))

### Optional

- `content_type` (String) Content type of the CDN preference configuration
- `description` (String) Description of the CDN preference configuration
- `version` (String) Version of the CDN preference configuration
- `last_updated` (String) Timestamp of when the configuration was last updated

<a id="nestedatt--availability_thresholds"></a>
### Nested Schema for `availability_thresholds`

Required:

- `continents` (Attributes Map) Continent-specific availability thresholds (see [below for nested schema](#nestedatt--availability_thresholds--continents))

Optional:

- `world` (Number) Global availability threshold (0-100)

<a id="nestedatt--availability_thresholds--continents"></a>
### Nested Schema for `availability_thresholds.continents`

Required:

- `default` (Number) Default threshold for the continent (0-100)
- `countries` (Map of Number) Country-specific thresholds (0-100)

<a id="nestedatt--performance_filtering"></a>
### Nested Schema for `performance_filtering`

Required:

- `world` (Attributes) Global performance filtering configuration (see [below for nested schema](#nestedatt--performance_filtering--world))
- `continents` (Attributes Map) Continent-specific performance configurations (see [below for nested schema](#nestedatt--performance_filtering--continents))

<a id="nestedatt--performance_filtering--world"></a>
### Nested Schema for `performance_filtering.world`

Required:

- `mode` (String) Performance filtering mode (valid values: "relative", "absolute")

Optional:

- `relative_threshold` (Number) Relative performance threshold for global filtering (range 0.0 to 1.0)

<a id="nestedatt--performance_filtering--continents"></a>
### Nested Schema for `performance_filtering.continents`


Required:

- `mode` (String) Performance filtering mode (valid values: "relative", "absolute")

Optional:

- `countries` (Attributes Map) Country-specific performance configurations (see [below for nested schema](#nestedatt--performance_filtering--continents--countries))
- `relative_threshold` (Number) Relative performance threshold for the continent (range 0.0 to 1.0)

<a id="nestedatt--performance_filtering--continents--countries"></a>
### Nested Schema for `performance_filtering.continents.countries`


Required:

- `mode` (String) Performance filtering mode (valid values: "relative", "absolute")

Optional:

- `relative_threshold` (Number) Relative performance threshold for the country (range 0.0 to 1.0)


<a id="nestedatt--enabled_subdivision_countries"></a>
### Nested Schema for `enabled_subdivision_countries`

Required:

- `continents` (Attributes Map) Continent-specific subdivision configurations (see [below for nested schema](#nestedatt--enabled_subdivision_countries--continents))

<a id="nestedatt--enabled_subdivision_countries--continents"></a>
### Nested Schema for `enabled_subdivision_countries.continents`

Required:

- `countries` (List of String) List of countries with enabled subdivisions